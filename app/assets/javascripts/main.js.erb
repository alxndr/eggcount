var allDaysData = <%= Day.to_json_object %>; // TODO replace with ajax call to json endpoint
var years = Object.keys(allDaysData);
var seriesData = years.reduce(function(data, year) {
  var yearData = allDaysData[year];
  var sanitizedYearData = yearData.map(function(dayData) {
    var month0indexed = parseInt(dayData.date.substring(5, 7), 10) - 1;
    var day = parseInt(dayData.date.substring(8, 10), 10);
    return [Date.UTC(1970, month0indexed, day), dayData.count];
  });
  data.push({
    name: year,
    data: sanitizedYearData
  });
  return data;
}, []);

(function() {
  $(function() {
    var $chart = $("#chart");

    $chart.highcharts({
      chart: { type: 'column' },
      title: { text: '' },
      xAxis: {
        type: 'datetime',
        dateTimeLabelFormats: { // don't display the dummy year
          month: '%b',
          year: '%b'
        },
        title: { text: 'date' }
      },
      yAxis: {
        title: { text: 'eggs' },
        min: 0
      },
      tooltip: {
        headerFormat: '<b>{series.name}</b><br>', // fake the year
        pointFormat: '{point.x:%b}: {point.y:.0f}'
      },
      plotOptions: {
        series: {
          borderWidth: 0
        }
      },

      series: seriesData,
    });
  });
})(this);
