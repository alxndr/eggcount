var daysData = <%= Day.to_json_object %>; // TODO replace with ajax call to json endpoint
var years = Object.keys(daysData);
var seriesData = years.reduce(function(seriesData, year) {
  var sanitizedYearData = daysData[year].map(function(dayData) {
    var month0indexed = parseInt(dayData.date.substring(5, 7), 10) - 1;
    var day = parseInt(dayData.date.substring(8, 10), 10);
    return [Date.UTC(1970, month0indexed, day), dayData.count];
  });
  seriesData.push( {
    name: year,
    data: sanitizedYearData
  });
  return seriesData;
}, []);

(function() {
  $(function() {
    var $chart = $("#chart");

    console.log(daysData);
    $chart.highcharts({
      chart: { type: 'spline' },
      title: { text: '' },
      xAxis: {
          type: 'datetime',
          dateTimeLabelFormats: { // don't display the dummy year
              month: '%e. %b',
              year: '%b'
          },
          title: {
              text: 'Date'
          }
      },
      yAxis: {
          title: { text: 'eggs' },
          min: 0
      },
      tooltip: {
          headerFormat: '<b>{series.name}</b><br>',
          pointFormat: '{point.x:%e. %b}: {point.y:.2f} m'
      },

      series: seriesData
    });
  });
})(this);
